!function(e){"use strict";navigator.platform.toUpperCase().indexOf("WIN"),navigator.platform.toUpperCase().indexOf("MAC"),navigator.platform.toUpperCase().indexOf("LINUX");const t=navigator.userAgent.toLowerCase().indexOf("firefox")>-1,a=/^((?!chrome).)*safari/i.test(navigator.userAgent),s=/chrom(e|ium)(edge)?/.test(navigator.userAgent.toLowerCase()),i=(navigator.userAgent.match("CriOS"),navigator.userAgent.match("MSIE"),navigator.userAgent.match("Edge")),o=(navigator.userAgent.toLowerCase().indexOf("android"),navigator.userAgent.match(/iPad/i),/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)),n=!!("Notification"in window&&!o&&(i||t||s||a)),r=!(!document.createElement("canvas").getContext||o||!t&&!s),l=200,d=e(".board"),c=d.find(".board__theme"),u=d.find(".board__lists"),f=e(".form--settings");var g,m;function h(){if(r){e("link[rel$=icon]").remove();var t=JSON.parse(localStorage.getItem("mahoweek")).settings.faviconCounter,a=u.find(".task--today").length;a>0&&!0===t?(e("head").append(e('<link rel="icon" type="image/png" sizes="32x32">').attr("href","img/favicon-today.png?v=2")),Tinycon.setBubble(a<=9?a:"9+")):e("head").append(e('<link rel="icon" type="image/png" sizes="32x32">').attr("href","favicon-32x32.png?v=3"))}}function _(){for(var e="",t="0123456789abcdefghijklmnopqrstuvwxyz",a=0;a<8;a++)e+=t.charAt(Math.floor(Math.random()*t.length));return e}function p(e){var t=new Date(e),a=t.getDate(),s=t.getMonth()+1,i=t.getFullYear(),o=t.getHours(),n=t.getMinutes();return(a<10?"0"+a:a)+"."+(s<10?"0"+s:s)+"."+i+" в "+(o<10?"0"+o:o)+":"+(n<10?"0"+n:n)}function k(t){t.settings.updatedTime=(new Date).getTime(),localStorage.setItem("mahoweek",JSON.stringify(t)),firebase.auth().currentUser&&(e(".sync__message").html("").hide(),e(".sync__ava, .menu__ava").attr("data-sync","process"),firebase.database().ref("users/"+firebase.auth().currentUser.uid+"/database").set({lists:t.lists,tasks:t.tasks,settings:t.settings}).then(function(){e(".sync__updated span").text(p(t.settings.updatedTime)),e(".sync__ava, .menu__ava").attr("data-sync","ok")}).catch(function(t){e(".sync__ava, .menu__ava").attr("data-sync","fail"),console.error(t.code+": "+t.message),e(".sync__message").html(t.code+": "+t.message).show()}))}o&&e("body").addClass("mobile"),function(){if(localStorage.getItem("mahoweek")){window.location.search&&window.history.replaceState(null,null,"/");var e=JSON.parse(localStorage.getItem("mahoweek"));c.addClass("board__theme--"+e.settings.theme)}else{localStorage.clear();var t=new Date,a=t.getTime(),s=t.getDate(),i=t.getMonth()+1,o=t.getFullYear()+"-"+(i<10?"0"+i:i)+"-"+(s<10?"0"+s:s),n=_(),r={lists:[{id:n,name:"Краткосрочный план дел",createdTime:a}],tasks:[{id:_(),listId:n,name:"Прочитать справку о сайте: https://mahoweek.ru/#about!",createdTime:a,markers:[{date:o,label:"bull"}]},{id:_(),listId:n,name:"Посмотреть как здесь всё устроено: https://mahoweek.ru/#tour",createdTime:a,markers:[{date:o,label:"bull"}]},{id:_(),listId:n,name:"21:00 Настроить доску: https://mahoweek.ru/#settings",createdTime:a,markers:[{date:o,label:"bull"}]},{id:_(),listId:n,name:"Добавить ещё дел в список",createdTime:a},{id:_(),listId:n,name:"Наметить на календарной сетке даты выполнения задач",createdTime:a}],settings:{createdTime:a,updatedTime:a,deleteCompletedTasks:!1,faviconCounter:!0,theme:"leaves"}};if(window.location.search){var l=window.location.search.replace("?","").split("&").reduce(function(e,t){var a=t.split("=");return e[decodeURIComponent(a[0])]=decodeURIComponent(a[1]),e},{});if("365dayz.ru"==l.src&&l.user){var d=_(),u="Проект «365 дней»: https://365dayz.ru/users/"+l.user+"/";r.lists.push({id:d,name:u,createdTime:a});var f=t.getDay();0==f&&(f=7);for(var g=[],m=0;m<=14-f;m++){var h=new Date,p=h.setDate(t.getDate()+m),k=h.getDate(p),v=h.getMonth(p)+1,y=h.getFullYear(p)+"-"+(v<10?"0"+v:v)+"-"+(k<10?"0"+k:k);g.push({date:y,label:"bull"})}r.tasks.push({id:_(),listId:d,name:"20:00 Загрузить фотографию: https://365dayz.ru/add/",createdTime:a,markers:g},{id:_(),listId:d,name:"Ознакомиться с расширенным аккаунтом: https://365dayz.ru/plus/",createdTime:a},{id:_(),listId:d,name:"Заполнить подробнее профиль: https://365dayz.ru/settings/profile/",createdTime:a})}window.history.replaceState(null,null,"/")}localStorage.setItem("mahoweek",JSON.stringify(r)),c.addClass("board__theme--leaves"),""==window.location.hash&&window.location.replace("#hello")}}(),g=new Date,setTimeout(function t(){if(e("body").hasClass("ready")){var a=new Date,s=a.getTime(),i=a.getHours(),o=a.getMinutes(),r=(i<10?"0"+i:i)+":"+(o<10?"0"+o:o);if(g.getDay()!=a.getDay())window.location.reload(!0);else{if(n&&(l=localStorage.getItem("notify"))&&"none"!==l&&"granted"===Notification.permission){var l;if(9e5==(l*=1))var d="15 минут",c=12e4;else 18e5===l?(d="30 минут",c=3e5):36e5===l?(d="1 час",c=6e5):72e5===l&&(d="2 часа",c=9e5);u.find(".task__time").each(function(){var t=e(this),a=t.parents(".task"),i=t.text(),o=a.find(".task__name").text();if(o=o.replace(/((2[0-3]|[0-1]\d):([0-5]\d)) /gi,""),a.find(".grid__date--today.grid__date--bull:not(.grid__date--completed)").length&&i>r)var n=a.find(".grid__date--today.grid__date--bull:not(.grid__date--completed)").attr("data-date")+"T"+i+":00";else a.find(".grid__date--today + .grid__date--bull").length&&(n=a.find(".grid__date--today + .grid__date--bull").attr("data-date")+"T"+i+":00");n&&(!a.attr("data-notify")||a.attr("data-notify")&&a.attr("data-notify")!==n)&&s+l>=Date.parse(n)&&s+l<=Date.parse(n)+c&&(new Notification("Через "+d+", в "+i,{body:o,icon:"img/notify.png?v=2",requireInteraction:!0}),a.attr("data-notify",n),yaCounter43856389.reachGoal("ya-alert-triggered")),a.find(".grid__date--today.grid__date--bull:not(.grid__date--completed)").length&&i===r&&!a.hasClass("task--now")&&(new Notification("Время "+i,{body:o,icon:"img/notify.png?v=2",requireInteraction:!0}),a.addClass("task--now"),yaCounter43856389.reachGoal("ya-alert-triggered"))})}u.find(".task__time").each(function(){var t=e(this),a=t.parents(".task"),s=t.text();a.find(".grid__date--today.grid__date--bull:not(.grid__date--completed)").length&&s<=r?a.addClass("task--now"):a.removeClass("task--now")})}}setTimeout(t,500)},500),function(){var t=0,a=0,s=o?"touchstart":"mousedown";u.on(s,".js-name",function(e){if("touchstart"==e.type){var a=e.originalEvent.touches[0]||e.originalEvent.changedTouches[0];t=a.pageX+a.pageY}else t=e.pageX+e.pageY});var i=o?"touchend":"mouseup";u.on(i,".js-name",function(s,i){var o=e(this);if("touchend"==s.type){var n=s.originalEvent.touches[0]||s.originalEvent.changedTouches[0];a=n.pageX+n.pageY}else a=s.pageX+s.pageY;if("mouseup"==s.type&&1!=s.which&&"run"!=i)return!1;if(!(e(s.target).hasClass("js-link-task")||e(s.target).hasClass("cartonbox")||t!=a&&"run"!=i)){if(u.removeClass("board__lists--drag"),o.hasClass("list__name")&&!o.parents(".list").find(".list__input").length){var r=o.text();o.html('<input class="list__input  js-edit-list" type="text" maxlength="255" value="">'),o.parents(".list").find(".list__input").val(r).select(),o.parents(".list").scrollLeft(0).css({"overflow-x":"hidden","-webkit-overflow-scrolling":"auto"}),o.parents(".list").find(".list__input").on("focusout",function(){o.html(w(e(this).val())),o.parents(".list").css({"overflow-x":"","-webkit-overflow-scrolling":""})})}if(o.hasClass("task__name")&&!o.parents(".task").find(".task__input").length){var l=o.text();o.html('<input class="task__input  js-edit-task" type="text" maxlength="255" value="">'),o.parents(".task").find(".task__input").val(l).focus(),o.parents(".list").scrollLeft(0).css({"overflow-x":"hidden","-webkit-overflow-scrolling":"auto"}),o.parents(".task").find(".task__input").on("focusout",function(){o.html(O(e(this).val())),o.parents(".list").css({"overflow-x":"","-webkit-overflow-scrolling":""})})}}})}(),m={speed:l,nav:!1,preload:!1,closeHtml:'<svg><use xlink:href="#icon-close"></use></svg>',onStartBefore:function(){e(".cartonbox-close").attr({role:"button",tabindex:0,"aria-label":"Закрыть"}).prependTo(".cartonbox-container")},onShowBefore:function(){e("body").addClass("modal-open")},onClosedBefore:function(){e("body").removeClass("modal-start"),e("body").removeClass("modal-open"),e("body").addClass("modal-closed")},onClosedAfter:function(){e("body").removeClass("modal-closed")}},e.cartonbox(m),"#hello"===window.location.hash&&e(".js-open-hello").trigger("click"),""!==window.location.hash&&e("body").addClass("modal-start"),e(".js-close-hello").on("click",function(){e(".cartonbox-close").trigger("click")}),function(){var e,t={},a=null,s=null,i=null,o=null,n={},r=Math.ceil(window.devicePixelRatio)||1,l=16*r,d={width:16,height:16,font:11*r+"px Courier New",color:"#000",background:"transparent",fallback:!1,crossOrigin:!0,abbreviate:!0},c=(e=navigator.userAgent.toLowerCase(),function(t){return-1!==e.indexOf(t)}),u=c("trident"),f=(c("chrome"),c("chrome")||c("safari")),g=c("safari")&&!c("chrome"),m=c("mozilla")&&!c("chrome")&&!c("safari"),h=function(){if(!s||!a){var e=function(){for(var e=document.getElementsByTagName("link"),t=0,a=e.length;t<a;t++)if((e[t].getAttribute("rel")||"").match(/\bicon\b/i))return e[t];return!1}();a=e?e.getAttribute("href"):"/favicon.ico",s||(s=a)}return a},_=function(){return o||((o=document.createElement("canvas")).width=l,o.height=l),o},p=function(e){if(e){!function(){for(var e=document.getElementsByTagName("link"),t=0,a=e.length;t<a;t++)void 0!==e[t]&&(e[t].getAttribute("rel")||"").match(/\bicon\b/i)&&e[t].parentNode.removeChild(e[t])}();var t=document.createElement("link");t.type="image/x-icon",t.rel="icon",t.href=e,document.getElementsByTagName("head")[0].appendChild(t)}},k=function(e){if(n.fallback){var t=document.title;"("===t[0]&&(t=t.slice(t.indexOf(" "))),document.title=(e+"").length>0?"("+e+") "+t:t}},v=function(e,t,a){"number"==typeof t&&t>99&&n.abbreviate&&(t=b(t));var s=(t+"").length-1,i=n.width*r+6*r*s,o=n.height*r,d=l-o,c=l-i-r,u=16*r,g=16*r,h=2*r;e.font=(f?"bold ":"")+n.font,e.fillStyle=n.background,e.strokeStyle=n.background,e.lineWidth=r,e.beginPath(),e.moveTo(c+h,d),e.quadraticCurveTo(c,d,c,d+h),e.lineTo(c,u-h),e.quadraticCurveTo(c,u,c+h,u),e.lineTo(g-h,u),e.quadraticCurveTo(g,u,g,u-h),e.lineTo(g,d+h),e.quadraticCurveTo(g,d,g-h,d),e.closePath(),e.fill(),e.strokeStyle="rgba(255, 255, 255, 0.9)",e.lineWidth=2,e.textAlign="right",e.textBaseline="top",e.strokeText(t,2===r?32:16,m?7*r:6*r),e.fillStyle=n.color,e.textAlign="right",e.textBaseline="top",e.fillText(t,2===r?32:16,m?7*r:6*r)},y=function(){_().getContext&&p(_().toDataURL())},b=function(e){for(var t=[["G",1e9],["M",1e6],["k",1e3]],a=0;a<t.length;++a)if(e>=t[a][1]){e=w(e/t[a][1])+t[a][0];break}return e},w=function(e,t){return new Number(e).toFixed(t)};t.setOptions=function(e){for(var t in n={},e.colour&&(e.color=e.colour),d)n[t]=e.hasOwnProperty(t)?e[t]:d[t];return this},t.setImage=function(e){return a=e,y(),this},t.setBubble=function(e,t){return function(e,t){if(!_().getContext||u||g||"force"===n.fallback)return k(e);var a=_().getContext("2d"),s=(t=t||"#000000",h());(i=document.createElement("img")).onload=function(){a.clearRect(0,0,l,l),a.drawImage(i,2,2,i.width,i.height,0,0,l,l),(e+"").length>0&&v(a,e,t),y()},!s.match(/^data/)&&n.crossOrigin&&(i.crossOrigin="anonymous"),i.src=s}(e=e||"",t),this},t.reset=function(){a=s,p(s)},t.setOptions(d),"function"==typeof define&&define.amd?define(t):"undefined"!=typeof module?module.exports=t:window.Tinycon=t}();function v(t){return firebase.database().ref("/users/"+t+"/database").once("value").then(function(a){if(null===a.val()){var s=JSON.parse(localStorage.getItem("mahoweek"));firebase.database().ref("users/"+t+"/database").set({lists:s.lists,tasks:s.tasks,settings:s.settings}).then(function(){localStorage.setItem("authorizedUser",!0),window.location.reload(!0)}).catch(function(t){console.error(t.code+": "+t.message),e(".sync__message").html(t.code+": "+t.message).show()})}else{var i={lists:void 0!==a.val().lists?a.val().lists:[],tasks:void 0!==a.val().tasks?a.val().tasks:[],settings:a.val().settings};localStorage.setItem("mahoweek",JSON.stringify(i)),localStorage.setItem("authorizedUser",!0),window.location.reload(!0)}}).catch(function(t){console.error(t.code+": "+t.message),e(".sync__message").html(t.code+": "+t.message).show()})}function y(e,t){var a={"2018-04-01":{icon:"😄",title:"День смеха",dayoff:!1},"2018-04-08":{icon:"🐇",title:"Пасха",dayoff:!1},"2018-04-12":{icon:"🚀",title:"День космонавтики",dayoff:!1},"2018-04-13":{icon:"😈",title:"Пятница 13",dayoff:!1},"2018-04-28":{title:"Сокращённый рабочий день (выходной перенесён на 30 апреля)",dayoff:!1},"2018-04-30":{title:"Праздничный день (выходной за счёт 28-го апреля)",dayoff:!0},"2018-05-01":{icon:"🌷",title:"Праздник Весны и Труда, праздничный день",dayoff:!0},"2018-05-02":{title:"Праздничный день (выходной за счёт 7-го января)",dayoff:!0},"2018-05-08":{title:"Сокращённый рабочий день",dayoff:!1},"2018-05-09":{icon:"🎆",title:"День Победы, праздничный день",dayoff:!0},"2018-07-13":{icon:"😈",title:"Пятница 13",dayoff:!1}},s=new Date,i=s.getDay();0==i&&(i=7);var o=1;if(t)for(var n={},r=0;r<t.length;r++){n[t[r].date]=t[r].label+"|"+(t[r].completed?1:0)}var l="";for(r=1-i;r<=14-i;r++){var d="",c=new Date,u=c.setDate(s.getDate()+r),f=c.getDate(u),g=c.getMonth(u)+1,m=c.getFullYear(u),h=c.getDay(),_=m+"-"+(g<10?"0"+g:g)+"-"+(f<10?"0"+f:f);s.getDate()==f&&(d+=" grid__date--today",o=0),o&&(d+=" grid__date--past"),"list"==e?_ in a?((6==h||0==h||a[_].dayoff)&&(d+=" grid__date--holiday"),l+='<div class="grid__date'+d+'" title="'+a[_].title+'">'+(void 0!==a[_].icon?a[_].icon:f)+"</div>"):(6!=h&&0!=h||(d+=" grid__date--holiday"),l+='<div class="grid__date'+d+'">'+f+"</div>"):"task"==e?(n&&_ in n&&("bull"==n[_].split("|")[0]&&(d+=" grid__date--bull"),1==n[_].split("|")[1]&&(d+=" grid__date--completed")),l+=o?'<div class="grid__date'+d+'"></div>':'<button type="button" class="grid__date  js-marker-task'+d+'" data-date="'+_+'" aria-label="Добавить или снять метку" ></button>'):"add-task"==e&&(l+='<div class="grid__date'+d+'"></div>')}return l}function b(){for(var e="",t=JSON.parse(localStorage.getItem("mahoweek")),a=0;a<t.lists.length;a++)e+=S(t.lists[a].id,t.lists[a].name);u.prepend(e),u.find(".list__grid").html(y("list")),u.find(".task__grid").html(y("add-task")),Sortable.create(document.querySelector(".board__lists"),{delay:l,animation:l,handle:".list__name",filter:".list__input",preventOnFilter:!1,ghostClass:"list--ghost",chosenClass:"list--chosen",dragClass:"list--drag",forceFallback:!0,fallbackClass:"list--fallback",fallbackOnBody:!0,scrollSensitivity:100,onChoose:function(){u.addClass("board__lists--drag")},onEnd:function(){u.removeClass("board__lists--drag")},onSort:function(e){var t=JSON.parse(localStorage.getItem("mahoweek")),a=t.lists.splice(e.oldIndex,1)[0];t.lists.splice(e.newIndex,0,a),k(t)}})}function w(e){var t=e;return t=/https:\/\/mahoweek\.ru\/#/.test(e)?t.replace(/(https:\/\/)(mahoweek\.ru\/#)([\S]+[^ ,\.!])/gi,'<a href="#$3" class="cartonbox" data-cb-type="inline" data-cb-hash="$3"><span class="hidden">$1</span>$2$3</a>'):t.replace(/(http(s)?:\/\/(www\.)?)([\S]+[^ ,\.!])/gi,'<a href="$1$4" class="js-link-task" target="_blank" rel="noopener noreferrer"><span class="hidden">$1</span>$4</a>')}function C(e){var t=u.find('.list[data-id="'+e+'"] .list__tasks .task').length,a=u.find('.list[data-id="'+e+'"] .task--completed').length;if(t>0)var s=100*a/t/100;else s=0;u.find('.list[data-id="'+e+'"] .list__progress').css({"-webkit-transform":"scaleX("+s+")",transform:"scaleX("+s+")"})}function S(e,t){return'<section class="list" data-id="'+e+'"><div class="list__head"><div class="list__wrap"><div class="list__name  js-name">'+w(t)+'</div><div class="list__options"><button type="button" class="list__trash  js-remove-list" aria-label="Удалить"><svg><use xlink:href="#icon-trash"></use></svg></button></div><div class="list__progress"></div></div><div class="list__grid  grid"></div></div><div class="list__tasks"></div><div class="list__foot"><div class="task  task--add"><div class="task__wrap"><label class="task__status" for="'+e+'-add-task" aria-label="Дело"><div class="task__plus"><svg><use xlink:href="#icon-plus"></use></svg></div></label><div class="task__name"><input id="'+e+'-add-task" class="task__input  js-add-task" type="text" maxlength="255"></div></div><div class="task__grid  grid"></div></div></div></section>'}function x(){var t=(new Date).getDay();0==t&&(t=7);var a=new Date;a.setDate(a.getDate()-t),a.setHours(23,59,59,999);for(var s=a.getTime(),i=[],o=JSON.parse(localStorage.getItem("mahoweek")),n=0;n<o.tasks.length;n++){if(!(o.settings.deleteCompletedTasks&&o.tasks[n].completed&&o.tasks[n].completedTime<=s))i.push(o.tasks[n]),u.find('.list[data-id="'+o.tasks[n].listId+'"] .list__tasks').append(j(o.tasks[n].id,o.tasks[n].name,o.tasks[n].completed,o.tasks[n].markers)),T(u.find('.task[data-id="'+o.tasks[n].id+'"]'))}for(n=0;n<o.lists.length;n++)C(o.lists[n].id),I(document.querySelectorAll(".list__tasks")[n]);o.tasks.length!=i.length&&(o.tasks=i,k(o)),e("body").addClass("ready"),h()}function I(e){Sortable.create(e,{group:"group",delay:l,animation:l/2,handle:".task__name",filter:".task__input",preventOnFilter:!1,ghostClass:"task--ghost",chosenClass:"task--chosen",dragClass:"task--drag",forceFallback:!0,fallbackClass:"task--fallback",fallbackOnBody:!0,scrollSensitivity:100,onChoose:function(){u.addClass("board__lists--drag")},onEnd:function(){u.removeClass("board__lists--drag")},onSort:function(e){var t=e.item.parentElement.parentElement.attributes["data-id"].value,a=e.item.attributes["data-id"].value,s=JSON.parse(localStorage.getItem("mahoweek")),i=s.tasks.filter(function(e){return e.id==a}),o=s.tasks.indexOf(i[0]);s.tasks[o].listId=t;var n=s.tasks.splice(o,1)[0];if(0===e.newIndex)s.tasks.splice(0,0,n);else{var r=e.item.previousElementSibling.attributes["data-id"].value,l=s.tasks.filter(function(e){return e.id==r}),d=s.tasks.indexOf(l[0]);s.tasks.splice(d+1,0,n)}k(s)},onAdd:function(e){C(e.to.parentElement.attributes["data-id"].value)},onRemove:function(e){C(e.from.parentElement.attributes["data-id"].value)}})}function T(e){e.find(".grid__date.grid__date--past.grid__date--bull:not(.grid__date--completed)").length&&!e.find(".grid__date.grid__date--today.grid__date--completed").length&&e.find(".grid__date.grid__date--past.grid__date--bull:not(.grid__date--completed):last").index()>e.find(".grid__date.grid__date--past.grid__date--completed:last").index()?e.addClass("task--past"):e.removeClass("task--past"),e.find(".grid__date:not(.grid__date--past):not(.grid__date--completed).grid__date--bull").length?e.addClass("task--bull"):e.removeClass("task--bull"),e.find(".grid__date--today.grid__date--bull:not(.grid__date--completed)").length?e.addClass("task--today"):e.removeClass("task--today")}function O(e){var t=e;return t=(t=/https:\/\/mahoweek\.ru\/#/.test(e)?t.replace(/(https:\/\/)(mahoweek\.ru\/#)([\S]+[^ ,\.!])/gi,'<a href="#$3" class="cartonbox" data-cb-type="inline" data-cb-hash="$3"><span class="hidden">$1</span>$2$3</a>'):t.replace(/(http(s)?:\/\/(www\.)?)([\S]+[^ ,\.!])/gi,'<a href="$1$4" class="js-link-task" target="_blank" rel="noopener noreferrer"><span class="hidden">$1</span>$4</a>')).replace(/(.+)?(\s)?((2[0-3]|[0-1]\d):([0-5]\d))(\s)?(.+)?/gi,'<span class="task__time">$3</span> $1$7').trim(),/[!]{1,}/.test(e)&&(t="<strong>"+t+"</strong>"),t}function j(e,t,a,s){if(1==a)a=" task--completed";else a="";return'<div class="task'+a+'" data-id="'+e+'"><div class="task__wrap"><div class="task__status"><button type="button" class="task__check  js-completed-task" aria-label="Отметить"></button></div><div class="task__name  js-name">'+O(t)+'</div><div class="task__options"><button type="button" class="task__trash  js-remove-task" aria-label="Удалить"><svg><use xlink:href="#icon-trash"></use></svg></button></div></div><div class="task__grid  grid">'+y("task",s)+"</div></div>"}firebase.initializeApp({apiKey:"AIzaSyBzWqGiMDErDxB_kUOO8-KYABo0_SYNap8",authDomain:"mahoweek-8c3db.firebaseapp.com",databaseURL:"https://mahoweek-8c3db.firebaseio.com"}),localStorage.getItem("authorizedUser")?(e(".sync__auth").addClass("sync__auth--hidden"),e(".sync__user").addClass("sync__user--show"),e(".sync__ava, .menu__ava").attr("data-sync","process"),firebase.auth().onAuthStateChanged(function(t){if(t){e(".sync__ava, .menu__ava").css("background-image","url("+t.photoURL+")"),e(".sync__name").text(t.displayName),e(".sync__ava").attr("data-provider",t.providerData[0].providerId),e(".menu__item--settings").addClass("menu__item--profile");var a=0;firebase.database().ref("/users/"+t.uid+"/database").on("value",function(t){if(a++,t.val().settings.updatedTime>JSON.parse(localStorage.getItem("mahoweek")).settings.updatedTime){var s={lists:void 0!==t.val().lists?t.val().lists:[],tasks:void 0!==t.val().tasks?t.val().tasks:[],settings:t.val().settings};localStorage.setItem("mahoweek",JSON.stringify(s)),window.location.reload(!0)}else 1==a&&(e(".sync__updated span").text(p(t.val().settings.updatedTime)),e(".sync__ava, .menu__ava").attr("data-sync","ok"),b(),x())})}else localStorage.clear(),window.location.replace("#bye"),window.location.reload(!0)})):(b(),x()),e(".js-login-sync").on("click",function(){var t=e(this);if(e(".sync__message").html("").hide(),e(".sync__auth").addClass("sync__auth--load"),!firebase.auth().currentUser){if("twitter"==t.attr("data-provider"))var a=new firebase.auth.TwitterAuthProvider;else"facebook"==t.attr("data-provider")&&((a=new firebase.auth.FacebookAuthProvider).addScope("public_profile"),a.addScope("email"));o?firebase.auth().signInWithRedirect(a):firebase.auth().signInWithPopup(a).then(function(e){v(e.user.uid)}).catch(function(t){e(".sync__auth").removeClass("sync__auth--load"),console.error(t.code+": "+t.message),e(".sync__message").html(t.code+": "+t.message).show()})}}),firebase.auth().getRedirectResult().then(function(e){e.credential&&v(e.user.uid)}).catch(function(t){e(".sync__auth").removeClass("sync__auth--load"),console.error(t.code+": "+t.message),e(".sync__message").html(t.code+": "+t.message).show()}),e(".js-logout-sync").on("click",function(){firebase.auth().currentUser&&(e(".sync__message").html("").hide(),firebase.auth().signOut().then(function(){localStorage.clear(),window.location.replace("#bye"),window.location.reload(!0)}).catch(function(t){console.error(t.code+": "+t.message),e(".sync__message").html(t.code+": "+t.message).show()}))}),e(".js-get-sync").on("click",function(){if(firebase.auth().currentUser)return e(".sync__message").html("").hide(),e(".sync__ava, .menu__ava").attr("data-sync","process"),e(".sync__hand").addClass("sync__hand--spin"),firebase.database().ref("/users/"+firebase.auth().currentUser.uid+"/database").once("value").then(function(t){var a=JSON.parse(localStorage.getItem("mahoweek"));if(t.val().settings.updatedTime>=a.settings.updatedTime){var s={lists:void 0!==t.val().lists?t.val().lists:[],tasks:void 0!==t.val().tasks?t.val().tasks:[],settings:t.val().settings};localStorage.setItem("mahoweek",JSON.stringify(s)),yaCounter43856389.reachGoal("ya-manually-sync"),window.location.reload(!0)}else firebase.database().ref("users/"+firebase.auth().currentUser.uid+"/database").set({lists:a.lists,tasks:a.tasks,settings:a.settings}).then(function(){e(".sync__ava, .menu__ava").attr("data-sync","ok"),yaCounter43856389.reachGoal("ya-manually-sync"),window.location.reload(!0)}).catch(function(t){e(".sync__ava, .menu__ava").attr("data-sync","fail"),e(".sync__hand").removeClass("sync__hand--spin"),console.error(t.code+": "+t.message),e(".sync__message").html(t.code+": "+t.message).show()})}).catch(function(t){e(".sync__ava, .menu__ava").attr("data-sync","fail"),e(".sync__hand").removeClass("sync__hand--spin"),console.error(t.code+": "+t.message),e(".sync__message").html(t.code+": "+t.message).show()})}),function(){if(r){f.find(".js-choose-favicon-counter").parents(".form__group").removeClass("form__group--hidden");var e=JSON.parse(localStorage.getItem("mahoweek")),t=e.settings.faviconCounter;!0===t?f.find(".js-choose-favicon-counter").attr("checked","checked"):f.find(".js-choose-favicon-counter").removeAttr("checked","checked"),f.find(".js-choose-favicon-counter").on("change",function(){t=f.find(".js-choose-favicon-counter").prop("checked"),(e=JSON.parse(localStorage.getItem("mahoweek"))).settings.faviconCounter=t,k(e),h()})}}(),n&&(f.find(".js-choose-notify").parents(".form__group").removeClass("form__group--hidden"),localStorage.getItem("notify")&&"granted"===Notification.permission?f.find('.js-choose-notify option[value="'+localStorage.getItem("notify")+'"]').attr("selected","selected"):localStorage.removeItem("notify"),f.find(".js-choose-notify").on("change",function(){var t=e(this).val(),a="Теперь добавьте время выполнения делам и держите сайт открытым в браузере, чтобы оповещения приходили.";"none"===t?localStorage.setItem("notify","none"):"granted"===Notification.permission?(localStorage.getItem("notify")&&"none"!==localStorage.getItem("notify")||new Notification("Оповещения включены",{body:a,icon:"img/notify.png?v=2",requireInteraction:!0}),localStorage.setItem("notify",t)):"default"===Notification.permission?Notification.requestPermission(function(e){"granted"===e?(localStorage.setItem("notify",t),new Notification("Оповещения включены",{body:a,icon:"img/notify.png?v=2",requireInteraction:!0})):(localStorage.setItem("notify","none"),f.find(".js-choose-notify option").removeAttr("selected","selected"))}):"denied"===Notification.permission&&(alert("Ранее вы блокировали отправку вам оповещений. Пожалуйста, разрешите оповещения в настройках сайта в браузере."),f.find(".js-choose-notify option").removeAttr("selected","selected"))})),function(){f.on("submit",function(e){e.preventDefault()});var e=JSON.parse(localStorage.getItem("mahoweek")),t=e.settings.theme,a=e.settings.deleteCompletedTasks;f.find('.js-choose-theme[value="'+t+'"]').attr("checked","checked"),!0===a?f.find(".js-choose-delete-completed-tasks").attr("checked","checked"):f.find(".js-choose-delete-completed-tasks").removeAttr("checked","checked"),f.find(".js-choose-theme, .js-choose-delete-completed-tasks").on("change",function(){t=f.find('.js-choose-theme[name="theme"]:checked').val(),a=f.find(".js-choose-delete-completed-tasks").prop("checked"),c.attr("class","board__theme  board__theme--"+t),(e=JSON.parse(localStorage.getItem("mahoweek"))).settings.theme=t,e.settings.deleteCompletedTasks=a,k(e)})}(),u.on("click",".js-marker-task:not(.grid__date--past):not(.grid__date--completed)",function(){var t=e(this),a=t.parents(".task"),s=a.parents(".list").attr("data-id"),i=a.attr("data-id"),o=t.attr("data-date"),n=JSON.parse(localStorage.getItem("mahoweek")),r=n.tasks.filter(function(e){return e.id==i}),l=n.tasks.indexOf(r[0]);if(n.tasks[l].markers){var d=n.tasks[l].markers.filter(function(e){return e.date==o});if(""!=d){var c=n.tasks[l].markers.indexOf(d[0]);n.tasks[l].markers.splice(c,1),t.removeClass("grid__date--bull")}else n.tasks[l].markers.push({date:o,label:"bull"}),t.addClass("grid__date--bull"),a.hasClass("task--completed")&&(delete n.tasks[l].completed,delete n.tasks[l].completedTime,a.removeClass("task--completed"))}else n.tasks[l].markers=[{date:o,label:"bull"}],t.addClass("grid__date--bull"),a.hasClass("task--completed")&&(delete n.tasks[l].completed,delete n.tasks[l].completedTime,a.removeClass("task--completed"));k(n),T(a),C(s),h()}),e(".js-add-list").on("click",function(){var t=_(),a="Краткосрочный план дел №"+(u.find(".list").length+1),s=(new Date).getTime(),i=JSON.parse(localStorage.getItem("mahoweek"));i.lists.push({id:t,name:a,createdTime:s}),k(i),u.append(S(t,a));var o=u.find(".list:last-child");I(document.querySelector(".list:last-child .list__tasks")),o.find(".list__grid").html(y("list")),o.find(".task__grid").html(y("add-task")),o.find(".js-name").trigger("mouseup",["run"]);var n=e(window);o.offset().top>n.scrollTop()+n.height()-30-80&&e("body, html").stop().animate({scrollTop:o.offset().top},l)}),u.on("keyup change",".js-edit-list",function(t){var a=e(this);if(13==t.keyCode||"change"==t.type){var s=a.parents(".list"),i=s.attr("data-id"),o=a.val(),n=JSON.parse(localStorage.getItem("mahoweek")),r=n.lists.filter(function(e){return e.id==i}),l=n.lists.indexOf(r[0]);n.lists[l].name=o,k(n),0==s.find(".list__tasks .task").length?s.find(".js-add-task").focus():a.blur()}}),u.on("click",".js-remove-list",function(){var t=e(this).parents(".list"),a=t.attr("data-id"),s=t.find(".list__tasks .task").length;if(s)var i=confirm("При удалении списка, все дела, находящиеся в нём, так же будут удалены.");if(!s||i){var o=JSON.parse(localStorage.getItem("mahoweek")),n=o.lists.filter(function(e){return e.id==a}),r=o.lists.indexOf(n[0]);if(o.lists.splice(r,1),s){for(var l=[],d=0;d<o.tasks.length;d++)o.tasks[d].listId!=a&&l.push(o.tasks[d]);o.tasks=l}k(o),t.remove(),h()}}),u.on("focusin",".js-add-task",function(){e(this).parents(".list").scrollLeft(0).css({"overflow-x":"hidden","-webkit-overflow-scrolling":"auto"})}),u.on("focusout",".js-add-task",function(){e(this).parents(".list").css({"overflow-x":"","-webkit-overflow-scrolling":""})}),u.on("keyup change",".js-add-task",function(t){var a=e(this);if(13===t.keyCode&&""!==a.val()||"change"===t.type){var s=a.parents(".list").attr("data-id"),i=_(),o=a.val(),n=(new Date).getTime(),r=JSON.parse(localStorage.getItem("mahoweek"));r.tasks.push({id:i,listId:s,name:o,createdTime:n}),k(r),a.val(""),a.parents(".list").find(".list__tasks").append(j(i,o)),C(s);var l=a.parents(".list").find(".list__tasks .task:last-child"),d=e(window);l.offset().top>d.scrollTop()+d.height()-30-40-39&&d.scrollTop(d.scrollTop()+l.outerHeight(!0)),yaCounter43856389.reachGoal("ya-add-task")}}),u.on("click",".js-completed-task",function(){var t=e(this).parents(".task"),a=t.parents(".list").attr("data-id"),s=t.attr("data-id"),i=t.hasClass("task--completed"),o=t.find(".grid__date--today").attr("data-date"),n=JSON.parse(localStorage.getItem("mahoweek")),r=n.tasks.filter(function(e){return e.id==s}),l=n.tasks.indexOf(r[0]);if(i)t.find(".grid__date--today").removeClass("grid__date--completed"),d="del",delete n.tasks[l].completed,delete n.tasks[l].completedTime,t.removeClass("task--completed");else{if(t.find(".grid__date--today").toggleClass("grid__date--completed"),t.find(".grid__date--today").hasClass("grid__date--completed"))var d="add";else var d="del";if(!t.find(".grid__date--today").nextAll(".grid__date--bull").length){t.find(".grid__date--today").addClass("grid__date--completed"),d="add";var c=(new Date).getTime();n.tasks[l].completed=1,n.tasks[l].completedTime=c,t.addClass("task--completed")}}if("add"!=d||n.tasks[l].markers){var u=n.tasks[l].markers.filter(function(e){return e.date==o});if(""!=u){var f=n.tasks[l].markers.indexOf(u[0]);"add"==d?n.tasks[l].markers[f].completed=1:n.tasks[l].markers[f].label?delete n.tasks[l].markers[f].completed:n.tasks[l].markers.splice(f,1)}else"add"==d&&n.tasks[l].markers.push({date:o,completed:1})}else n.tasks[l].markers=[{date:o,completed:1}];k(n),T(t),C(a),h()}),u.on("keyup change",".js-edit-task",function(t){var a=e(this);if(13==t.keyCode||"change"==t.type){var s=a.parents(".task").attr("data-id"),i=a.val(),o=JSON.parse(localStorage.getItem("mahoweek")),n=o.tasks.filter(function(e){return e.id==s}),r=o.tasks.indexOf(n[0]);o.tasks[r].name=i,k(o),a.blur()}}),u.on("click",".js-remove-task",function(){var t=e(this),a=t.parents(".list").attr("data-id"),s=t.parents(".task").attr("data-id"),i=JSON.parse(localStorage.getItem("mahoweek")),o=i.tasks.filter(function(e){return e.id==s}),n=i.tasks.indexOf(o[0]);i.tasks.splice(n,1),k(i),t.parents(".task").remove(),C(a),h(),yaCounter43856389.reachGoal("ya-remove-task")})}(jQuery);